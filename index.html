<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html"/>
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Refinement web Atlas beta test</title>

    <!-- Core CSS -->
	<link rel="stylesheet" href="css/leaflet.awesome-markers.css"/>
	<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>   
	<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/typeahead.js-bootstrap.css" rel="stylesheet" type="text/css"/> 

	
	<link rel="stylesheet" href="css/cartodb.css" />
	

		
	<script src="js/cartodb.js"></script>

    <!-- Custom styles for this template -->
    <style>
               html, body, #sidebar, #container {
            height: 100%;
            margin: 0px;
        }

        body {
            padding-top: 50px;
        }
        label {
            font-weight: normal;
        }
        #map {
            height: 100%;
            margin: 0px;
            -webkit-box-shadow: 0 -1px 10px rgba(0,0,0,0.5);
            -moz-box-shadow: 0 -1px 10px rgba(0,0,0,0.5);
            box-shadow: 0 -1px 10px rgba(0,0,0,0.5);
        }
        #loading {
            position: absolute;
            width: 220px;
            height: 19px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -110px;
            z-index: 20001;
        }
        .navbar .navbar-brand {
            font-weight: bold;
            font-size: 22px;
            color: white;
            white-space: nowrap;
        }
        .tt-dropdown-menu {
            overflow: auto;
        }
        .tt-hint, .tt-query {
            display: block;
            width: 100%;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
        }
        .typeahead-header {
            margin: 0 5px 5px 5px;
            padding: 3px 0;
            border-bottom: 1px solid #ccc;
        }
        .search-container {
            width: 350px;
        }
        #searchbox {
            -webkit-border-top-left-radius: 4px;
            -webkit-border-bottom-left-radius: 4px;
            -moz-border-top-left-radius: 4px;
            -moz-border-bottom-left-radius: 4px;
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }
        .leaflet-popup-content {
            margin-top: 14px;
            margin-bottom: 0px;
            margin-left: 20px;
            margin-right: 20px;
        }
        .panel-heading a:hover {
            text-decoration: none;
        }
        a.toggle {
            position: fixed;
            left: 0;
            bottom: 0;
            display: block;
            -webkit-border-radius: 0 !important;
            -moz-border-radius: 0 !important;
            border-radius: 0 !important;
            -webkit-border-top-right-radius: 4px !important;
            -moz-border-top-right-radius: 4px !important;
            border-top-right-radius: 4px !important;
            -webkit-border-bottom-right-radius: 4px !important;
            -moz-border-bottom-right-radius: 4px !important;
            border-bottom-right-radius: 4px !important;
            background-color: #222;
            color: white;
            opacity: 0.8;
            z-index: 100;
        }
        a:hover.toggle {
            background-color: #222;
            color: white;
            opacity: 1;
        }
		
		
		/* override bootstrap styles */
        .dropdown-submenu{position:relative;}
		.dropdown-submenu>.dropdown-menu
		{
			top:0;
			left:100%;
			margin-top:-6px;
			margin-left:-1px;
			-webkit-border-radius:0 6px 6px 6px;
			-moz-border-radius:0 6px 6px 6px;
			border-radius:0 6px 6px 6px;
		}
		.dropdown-submenu:hover>.dropdown-menu{display:block;}
		.dropdown-submenu>a:after{display:block;content:" ";float:right;width:0;height:0;border-color:transparent;border-style:solid;border-width:5px 0 5px 5px;border-left-color:#cccccc;margin-top:5px;margin-right:-10px;}
		.dropdown-submenu:hover>a:after{border-left-color:#ffffff;}
		.dropdown-submenu.pull-left{float:none;}
		.dropdown-submenu.pull-left>.dropdown-menu
		{left:-100%;margin-left:10px;-webkit-border-radius:6px 0 6px 6px;-moz-border-radius:6px 0 6px 6px;border-radius:6px 0 6px 6px;}
		
		.leaflet-control-attribution {
			padding: 0;            }
		
		.legend {
			z-index: 2;
			width:250px;
			height:580px;
			background-color:#FFFFFF;
			padding:10px;
			font-family: Arial, sans-serif;
			font-size:12px;
			border: 1px solid #999999;
			line-height:1.3em;
			position: absolute;
			top: 175px;
			right: 25px;
		}
.legend h1 {
	font-size:18px;
	margin:0 0 4px 0;
	text-align: center;
}
.legend h2 {
	font-size:16px;
	margin:0;
}
.legend h3 {
	font-size:13px;
	margin: 10px 0 0 0;
}
.legend .colors {
	float:left;
	line-height:23px;
	width:250px;
	margin: 10px 0;
	font-weight: bold;
}
.panel .colors span {
	height:20px;
	width:20px;
	margin-right:5px;
	display:block;
	float:left;
	clear:left;
	opacity: 0.7;
}
.panel .one {
	background-color: #800026;

}
.panel .two {
	background-color: #BD0026;

}
.panel .three {
	background-color: #E31A1C;

}
.panel .four {
	background-color: #FC4E2A;

}
.panel .five {
	background-color: #FD8D3C;

}
.panel .six {
	background-color: #FEB24C;

}
.panel .seven {
	background-color: #FED976;

}
.panel .seven {
	background-color: #FFEDA0;
}

.panel .urban-one {
	background-color: #FF0000;
}
.panel .urban-two {
	background-color: #FFFF00;
}
.panel .urban-three {
	background-color: #009900;
}

.panel .iso-one {
	background-color: #9FCB80;
}
.panel .iso-two {
	background-color: #D5E080;
}
.panel .iso-three {
	background-color: #FED480;
}
.panel .iso-four {
	background-color: #EF7E80;
}



.panel p {
	clear:both;
	margin:5px 0 0 0;
}
		

        @media (max-width: 992px) {
            .navbar .navbar-brand {
                font-size: 18px;
                float: left;
            }
            .search-container {
                width: 150px;
            }
            .leaflet-control-attribution {
                display: none;
            }
        }
       
	   		 @media (max-width: 768px){
            
			html, body, #map {
            font-size: 12px;	
        }
			.btn{font-size:12px;}
			#searchbox {
                width: 300px;
            }
			.search-container {
                width: 300px;
            }
			 .leaflet-control-attribution {
                display: none;
            }
}
	   
	   
	   
        /* Print Handling */
        @media print {
            .navbar, .toggle, #sidebar {
                display: none !important;
            }
		.leaflet-control-zoom{ display: none !important;}
        }
    </style>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.2.0/respond.js"></script>
    <![endif]-->

  </head>

  <body>

   <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.refinementproject.eu">Refinement Atlas</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" onclick="$('#aboutModal').modal('show'); return false;"><i class="icon-question-sign" style="color: white"></i>&nbsp;&nbsp;About</a></li>
                <li class="dropdown">
                        <a id="toolsDrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">
					&nbsp;Population density
							<b class="caret"></b>
						</a>
                            <ul class="dropdown-menu">
                                <li class="divider"></li>
												<li><a href="#Austria" id="Austria" class="button Austria"><span>AUSTRIA</span></a></li><br>	
												<li><a href="#England" id="England" class="button England"><span>ENGLAND</span></a></li><br>	
												<li><a href="#Estonia" id="Estonia" class="button Estonia"><span>ESTONIA</span></a></li><br>	
												<li><a href="#Finland" id="Finland" class="button Finland"><span>FINLAND</span></a></li><br>	
												<li><a href="#France" id="France" class="button France"><span>FRANCE</span></a></li><br>	
												<li><a href="#Italy" id="Italy" class="button Italy"><span>ITALY</span></a></li><br>	
												<li><a href="#Norway" id="Norway" class="button Norway"><span>NORWAY</span></a></li><br>	
												<li><a href="#Romania" id="Romania" class="button Romania"><span>ROMANIA</span></a></li><br>	
												<li><a href="#Spain" id="Spain" class="button Spain"><span>SPAIN</span></a></li>
                                <li class="divider"></li>
                            </ul>
                    </li>
 					 <li class="dropdown">
                        <a id="toolsDrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">
						&nbsp;Degree of urbanization 2011
							<b class="caret"></b>
						</a>
                            <ul class="dropdown-menu">
                                <li class="divider"></li>
												<li><a href="#Austria_urb" id="Austria_urb" class="button Austria_urb"><span>AUSTRIA</span></a></li><br>	
												<li><a href="#England_urb" id="England_urb" class="button England_urb"><span>ENGLAND</span></a></li><br>	
												<li><a href="#Estonia_urb" id="Estonia_urb" class="button Estonia_urb"><span>ESTONIA</span></a></li><br>	
												<li><a href="#Finland_urb" id="Finland_urb" class="button Finland_urb"><span>FINLAND</span></a></li><br>	
												<li><a href="#France_urb" id="France_urb" class="button France_urb"><span>FRANCE</span></a></li><br>	
												<li><a href="#Italy_urb" id="Italy_urb" class="button Italy_urb"><span>ITALY</span></a></li><br>	
												<li><a href="#Norway_urb" id="Norway_urb" class="button Norway_urb"><span>NORWAY</span></a></li><br>	
												<li><a href="#Romania_urb" id="Romania_urb" class="button Romania_urb"><span>ROMANIA</span></a></li><br>	
												<li><a href="#Spain_urb" id="Spain_urb" class="button Spain_urb"><span>SPAIN</span></a></li>
                                <li class="divider"></li>
                            </ul>
							
                    </li>
	<li class="dropdown">
					 <a id="toolsDrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown" >
						&nbsp;Drive time
						<b class="caret"></b>
					 </a>
						<ul class="dropdown-menu"> 
							<li class="divider"></li>						
							<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">AUSTRIA</a>    
							<ul class="dropdown-menu">        	
								<li><a href="#Austria_iso_a" id="Austria_iso_a" class="button Austria_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
							<br>							
							<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">ENGLAND</a>    
							<ul class="dropdown-menu">        	
								<li><a href="#England_iso_m" id="England_iso_m" class="button England_iso_m"><span>Mobile services</span></a></li>
								<li><a href="#England_iso_a" id="England_iso_a" class="button England_iso_a"><span>Acute hospital</span></a></li>     
							</ul>      
							</li>
							<br>
							<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">ESTONIA</a>    
							<ul class="dropdown-menu">        	
                        <li><a href="#Estonia_iso_a" id="Estonia_iso_a" class="button Estonia_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
						<br>						
							<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">FINLAND</a>    
							<ul class="dropdown-menu">        	
								<li><a href="#Finland_iso_m" id="Finland_iso_m" class="button Finland_iso_m"><span>Mobile services</span></a></li>
								<li><a href="#Finland_iso_a" id="Finland_iso_a" class="button Finland_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
						<br>				
						<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">FRANCE</a>    
							<ul class="dropdown-menu">        	
								<li><a href="#France_iso_m" id="France_iso_m" class="button France_iso_m"><span>Mobile services</span></a></li>
                        <li><a href="#France_iso_a" id="France_iso_a" class="button France_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
						<br>						
						<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">ITALY</a>    
							<ul class="dropdown-menu">        	
							 <li><a href="#Italy_iso_m" id="Italy_iso_m" class="button Italy_iso_m"><span>Mobile services</span></a></li>
                        <li><a href="#Italy_iso_a" id="Italy_iso_a" class="button Italy_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
						<br>						
						<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">NORWAY</a>    
							<ul class="dropdown-menu">        	
							 <li><a href="#Norway_iso_m" id="Norway_iso_m" class="button Norway_iso_m"><span>Mobile services</span></a></li>
                        <li><a href="#Norway_iso_a" id="Norway_iso_a" class="button Norway_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 
						<br>
						<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">ROMANIA</a>    
							<ul class="dropdown-menu">        	
                        <li><a href="#Romania_iso_a" id="Romania_iso_a" class="button Romania_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 	
							<br>							
						<li class="dropdown-submenu">        
								<a tabindex="-1" href="#">SPAIN</a>    
							<ul class="dropdown-menu">        	
							 <li><a href="#Spain_iso_m" id="Spain_iso_m" class="button Spain_iso_m"><span>Mobile services</span></a></li>
                        <li><a href="#RSpain_iso_a" id="Spain_iso_a" class="button Spain_iso_a"><span>Acute hospital</span></a></li>
							</ul>      
							</li> 	
							<li class="divider"></li>							
						</ul>  
					</li>  	
            </ul>
            <form class="navbar-form navbar-right">
                <div class="input-group search-container">
                    <input id="searchbox" type="text" class="form-control" placeholder="Search">
                    <span class="input-group-addon"><i class="icon-search"></i></span>
                </div>
            </form>
        </div><!--/.navbar-collapse -->
    </div>

    <div class="row" id="container">
        <div class="col-sm-3 col-lg-3" id="sidebar" style="padding: 10px; overflow: auto;">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active"><a href="#layers" data-toggle="tab"><i class="icon-check"></i>&nbsp;Layers</a></li>
                <li><a href="#help" data-toggle="tab"><i class="icon-question"></i>&nbsp;Help</a></li>
            </ul>
            <div class="tab-content" style="padding-top: 10px;">
                <div class="tab-pane active" id="layers">
                    <div class="panel-group">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#overlay-layers">
                                    Overlay Layers
                                </a>
                            </div>
                            <div id="overlay-layers" class="panel-collapse collapse in">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="study_area" z-index="2">
                                            Study area
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="macro_area" z-index="1">
                                          Macro area
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="residential_markers" z-index="3">
                                            Residential&nbsp;<i class='icon-hospital icon-large'></i>&nbsp;&nbsp;<i class='icon-home icon-large'></i>
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="daycare_markers" z-index="3">
                                            Daycare&nbsp;<i class="icon-plus-sign-alt icon-large"></i>
                                        </label>
                                    </div>
									 <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="outpatient_mobile_markers" z-index="3">
                                            Outpatient mobile&nbsp;<i class="icon-ambulance icon-large"></i>
                                        </label>
                                    </div>
									<div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="outpatient_non_mobile_markers" z-index="3">
                                            Outpatient non mobile&nbsp;<i class="icon-medkit icon-large"></i>&nbsp;&nbsp;<i class='icon-user-md icon-large'></i>
                                        </label>
                                    </div>
									<span class="icon-stack">
										<i class="awesome-marker-icon-green awesome-marker"></i>
									</span>&nbsp;&nbsp;&nbsp;Community based
									<br><br>
									<span class="icon-stack">
										<i class="awesome-marker-icon-red awesome-marker"></i>
									</span>&nbsp;&nbsp;&nbsp;Hospital based<br><br>
									<span class="icon-stack">
										<i class="awesome-marker-icon-blue awesome-marker"></i>
									</span>&nbsp;&nbsp;&nbsp;Private<br><br>
									<a href="#Reset_layer" id="Reset_layer" class="button Reset_layer"><i class="icon-trash"></i>&nbsp;Clear map</a>
		<!--button id="btnPrint" type="button" class="btn btn-primary"><i class="icon-print"></i>&nbsp;Print map</button-->
                                </div>
                            </div>
                        </div>
                         <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#basemap-layers">
                                    Legend
                                </a>
                            </div>
                            <div id="legend_density" class="panel-collapse collapse in" style="display:none">
                                <div class="panel-body" style="padding: 0px 15px;">
                                   	<h3>People per square km</h3>
									<div class="colors">
										<span class="one"></span>
										1000+ <b> Highest</b>
										<br>
										<span class="two"></span>
										500 - 1000
										<br>
										<span class="three"></span>
										200 - 500
										<br>
										<span class="four"></span>
										100 - 200<b> Middle</b>
										<br>
										<span class="five"></span>
										60 - 100<br>
										<span class="six"></span>
										30 - 60<br>
										<span class="seven"></span>
										20 - 30<br>
										<span class="eight"></span>
										0 - 20<b> Lowest</b>
									</div>
                                </div>
								</div>
							 <div id="legend_urban" class="panel-collapse collapse in" style="display:none">
                                <div class="panel-body" style="padding: 0px 15px;">
                                   	<h3>Degree of urbanisation 2011</h3>
									<label>Sources: EFGS, JRC, Eurostat, LandScan, REGIO-GIS</label>
									<div class="colors">
										<span class="urban-one"></span>
										<b> Densely populated area</b>
										<br>
										<span class="urban-two"></span>
										<b> Intermediate density area</b>
										<br>
										<span class="urban-three"></span>
										<b> Thinly-populated area</b>
									</div>
                                </div>
                            </div>
							 <div id="legend_iso" class="panel-collapse collapse in" style="display:none">
                                <div class="panel-body" style="padding: 0px 15px;">
                                   	 	<h3>Percentage of people living within:</h3>
									<div class="colors">
										<span class="iso-one"></span>
										0-10 minutes
										<br>
										<span class="iso-two"></span>
										10 - 20
										<br>
										<span class="iso-three"></span>
										20 - 30
										<br>
										<span class="iso-four"></span>
										30 >
									</div>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
                <div class="tab-pane" id="help">
                    According to the DESDE-LTC classification, In the Mapping service location section has been included only
mental health oriented services (MD), i.e. services exclusively addressed to psychiatric patients categorized.
The three DESDE-LTC employed in this Atlas are the following:
 <li class="list-group-item">RESIDENTIAL CARE CODING BRANCH (R): Facilities that provide beds overnight for patients for a
purpose related to the clinical and social management of their long term care needs - patients are
not intended to sleep there solely because they have no home or are unable to reach home.</li>
 <li class="list-group-item">DAY CARE CODING BRANCH (D): These are facilities that (i) are normally available to several users
at a time (rather than delivering services to individuals one at a time); (ii) provide some
combination of treatment for problems related to long-term care needs: e.g. providing a structured
activity, or social contact and/or support; (iii) have regular opening hours during which they are
normally available: and (iv) expect service users to stay at the facilities beyond the periods during
which they have face-to-face contact with staff (i.e. the service is not simply based on individuals
coming for appointments with staff and then leaving immediately after their appointments). The
care delivery is usually planned in advance.</li>
 <li class="list-group-item">OUTPATIENT CARE CODING BRANCH (O): These are facilities which (i) involve contact between
staff and users for some purpose related to management of their condition and its associated clinical and social difficulties and (ii) are not provided as a part of delivery of residential or day
services, as defined above.</li>
                </div>
            </div>
        </div>
        <div class="col-sm-9 col-lg-9" id="map">
            <div id="loading" style="display: block;">
                <div class="loading-indicator">
                    <div class="progress progress-striped active">
                        <div class="progress-bar progress-bar-info" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="#" type="button" rel="tooltip" class="toggle btn btn-default" data-toggle="tooltip" data-placement="right" title="Toggle sidebar"><i class="icon-chevron-left"></i></a>

    <div class="modal fade" id="aboutModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Welcome to the Refinement web Atlas</h4>
                </div>

                <div class="modal-body">
                     <ul id="aboutTabs" class="nav nav-tabs">
                        <li class="active"><a href="#about" data-toggle="tab"><i class="icon-question-sign"></i>&nbsp;About the project</a></li>
<!--                         <li><a href="#disclaimer" data-toggle="tab"><i class="icon-exclamation-sign"></i>&nbsp;Disclaimer</a></li>
 -->                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-globe"></i>&nbsp;Metadata <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#services-tab" data-toggle="tab">Mental Health services</a></li>
                                <li><a href="#population-tab" data-toggle="tab">Population density</a></li>
                                <li><a href="#urban-tab" data-toggle="tab">Degree of urbanisation 2011</a></li>
                                <li><a href="#osm-tab" data-toggle="tab">Isochrones</a></li>
                            </ul>
                        </li>
                    </ul>
                    <div id="aboutTabsContent" class="tab-content" style="padding-top: 10px;">
                        <div class="tab-pane fade active in" id="about">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    Refinement (REsearch on FINancing systems’ Effect on the quality of MENTal health care) project
                                </div>
                                <ul class="list-group">
                                    <li class="list-group-item">The first ever comparative and comprehensive overview of links between the financing of mental health care in Europe and the outcomes of mental health services</li>
                                 
                                    <li class="list-group-item"><a href="http://www.refinementproject.eu" target="_blank">REFINEMENT PROJECT</a></li>
                                   
                                </ul>
                            </div>
                        </div>
                      <!--   <div class="tab-pane fade text-danger" id="disclaimer">
                            <p>The data provided on this site is for informational and planning purposes only.</p>
                            <p>Absolutely no accuracy or completeness guarantee is implied or intended. All information on this map is subject to such variations and corrections as might result from a complete title search and/or accurate field survey.</p>
                        </div> -->
                        <div class="tab-pane fade" id="services-tab">
                            <p>Data on Mental Health services has been retrieved from REMAST (Refinement Mapping Services Toolkit) toolkit for each country <a href="http://rpc.spsichiatria.univr.it/refinement_sif" target="_blank">Refinement SIF (Service Inventory file)</a></p>
                        </div>
                        <div class="tab-pane fade" id="population-tab">
                            <p>Data has been retrieved from National Statistic Institutes of each country</a></p>
                        </div>
                        <div class="tab-pane fade" id="urban-tab">
                            <p>data sources <a href="http://ec.europa.eu/eurostat/ramon/miscellaneous/index.cfm?TargetUrl=DSP_DEGURBA" target="_blank">The Degree of urbanisation (DEGURBA)</a></p>
                        </div>
                        <div class="tab-pane fade" id="osm-tab">
                            <p>Isochrones maps has been build combining information from:Location of mental health services, Distribution of the resident population in the study area of each country and details of the road network (<a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a>)</p>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/typeahead.min.js"></script> 
	<link rel="stylesheet" href="Leafletmarkercluster6/dist/MarkerCluster.css" />
	<link rel="stylesheet" href="Leafletmarkercluster6/dist/MarkerCluster.Default.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="Leafletmarkercluster6/dist/MarkerCluster.Default.ie.css" /><![endif]-->
	<script src="Leafletmarkercluster6/dist/leaflet.markercluster-src.js"></script>
	<link rel="stylesheet" href="css/Control.MiniMap.css" />
	<script src="js/Control.MiniMap.js" type="text/javascript"></script>
	<script src="js/leaflet-providers.js"></script>
	<script src="js/leaflet.awesome-markers.js"></script>
	<script src="data/macro_boundary.js"></script>
	<script src="data/boundary.js"></script>
	<script src="data/residential.js"></script>
	<script src="data/daycare.js"></script>
	<script src="data/outpatient_mobile.js"></script>
	<script src="data/outpatient_non_mobile.js"></script>
	<script type="text/javascript">
	
		var map, residentialSearch = [], daycareSearch = [],outpatient_mSearch = [], outpatient_non_Search= [];


        $(document).ready(function() {
            $('[rel=tooltip]').tooltip();
            if (document.body.clientWidth <= 767) {
                $('#sidebar').toggle();
                $('a.toggle i').toggleClass('icon-chevron-left icon-chevron-right');
            };
        });
        $(window).resize(function() {
            $('.tt-dropdown-menu').css('max-height', $('#container').height()-$('.navbar').height()-20);
        });

        $('a.toggle').click(function() {
            $('a.toggle i').toggleClass('icon-chevron-left icon-chevron-right');
            $('#map').toggleClass('col-sm-9 col-lg-9 col-sm-12 col-lg-12');
            $('#sidebar').toggle();
            map.invalidateSize();
            return false;
        });

        $('input[name="basemapLayers"]').change(function () {
            // Remove unchecked layers
            $('input:radio[name="basemapLayers"]:not(:checked)').each(function () {
                map.removeLayer(window[$(this).attr('id')]);
            });
            // Add checked layer
            $('input:radio[name="basemapLayers"]:checked').each(function () {
                map.addLayer(window[$(this).attr('id')]);
            });
        });

        $('input:checkbox[name="overlayLayers"]').change(function () {
            var layers = [];
            function sortByKey(array, key) {
                return array.sort(function (a, b) {
                    var x = a[key];
                    var y = b[key];
                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                });
            }
            if ($('#' + $(this).attr('id')).is(':checked')) {
                $('input:checkbox[name="overlayLayers"]').each(function () {
                    // Remove all overlay layers
                    map.removeLayer(window[$(this).attr('id')]);
                    if ($('#' + $(this).attr('id')).is(':checked')) {
                        // Add checked layers to array for sorting
                        layers.push({
                            'z-index': $(this).attr('z-index'),
                            'layer': $(this)
                        });
                    }
                });
                // Sort layers array by z-index
                var orderedLayers = sortByKey(layers, 'z-index');
                // Loop through ordered layers array and add to map in correct order
                $.each(orderedLayers, function () {
                    map.addLayer(window[$(this)[0].layer[0].id]);
                });
            } else {
                // Simply remove unchecked layers
                map.removeLayer(window[$(this).attr('id')]);
            }
        });

		//LEAFLET
	
		
		
        // Basemap Layers
       var cloudmadeUrl='http://{s}.tile.osm.org/{z}/{x}/{y}.png';
		var cloudmadeAttrib='&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors';
		var osm = new L.TileLayer(cloudmadeUrl, {attribution: cloudmadeAttrib,zIndex: -1});
		
		var stamenUrl='http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png';
		var stamenAttrib='Tiles by Stamen Design';
		var stamen_toner = new L.TileLayer(stamenUrl, {attribution: stamenAttrib,maxZoom: 10, minZoom: 4,zIndex: -1});

		var	esri = L.tileLayer.provider('Esri.WorldStreetMap',{minZoom: 11,maxZoom: 16,zIndex: -1});
		var esri_satellite= L.tileLayer.provider('Esri.WorldImagery',{minZoom: 17,maxZoom: 18,zIndex: -1});
	
		var cloudmade2 = new L.TileLayer(cloudmadeUrl, {minZoom: 0, maxZoom: 13, attribution: cloudmadeAttrib });

        // Overlay Layers
		
		var Studyarea_style = {
				"weight":3,
				"color":'#0000FF',
				"opacity":0.9,
				"fillColor":'#FFFFFF',
				"fillOpacity":0.1
		};	
		
		england = new L.geoJson(england, {style:Studyarea_style});
		austria = new L.geoJson(austria, {style:Studyarea_style});
		italy = new L.geoJson(italy, {style:Studyarea_style});
		france = new L.geoJson(france, {style:Studyarea_style});
		finland = new L.geoJson(finland, {style:Studyarea_style});
		norway = new L.geoJson(norway, {style:Studyarea_style});
		spain = new L.geoJson(spain, {style:Studyarea_style});
		romania = new L.geoJson(romania, {style:Studyarea_style});
		estonia = new L.geoJson(estonia, {style:Studyarea_style});

var study_area = L.layerGroup([england,austria,italy,france,finland,spain,estonia,romania,norway]);			

//macro area 	
var Macroarea_style = {
    "weight":2,
	"color":'#990000',
	"opacity":0.9,
	"fillColor":'#FFFFFF',
	"fillOpacity":0.1
};	

		en_macro = new L.geoJson(en_macro, {style:Macroarea_style});
		at_macro = new L.geoJson(at_macro, {style:Macroarea_style});
		ee_macro = new L.geoJson(ee_macro, {style:Macroarea_style});
		fi_macro = new L.geoJson(fi_macro, {style:Macroarea_style});
		fr_macro = new L.geoJson(fr_macro, {style:Macroarea_style});
		it_macro = new L.geoJson(it_macro, {style:Macroarea_style});
		no_macro = new L.geoJson(no_macro, {style:Macroarea_style});
		ro_macro = new L.geoJson(ro_macro, {style:Macroarea_style});
		es_macro = new L.geoJson(es_macro, {style:Macroarea_style});


var macro_area = L.layerGroup([en_macro,at_macro,ee_macro,fi_macro,fr_macro,it_macro,no_macro,ro_macro,es_macro]);	


//RESIDENTIAL
var	residential_markers = new L.MarkerClusterGroup({showCoverageOnHover: false,spiderfyOnMaxZoom:true,maxClusterRadius:20}); 

        var residential = L.geoJson(residential, {
            pointToLayer: function (feature, latlng) {
			if (feature.properties.group_b =='COMUNITY-BASED'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-home', color: 'green'}), 
						 title: feature.properties.name,
						 riseOnHover: true})}
			if (feature.properties.group_b =='HOSPITAL'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'hospital', color:'red'}), 
						title: feature.properties.name,
						riseOnHover: true})}
            },
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var content =   '<b>Name: </b>'+feature.properties.name+'<br/><b>Address: </b>'+feature.properties.indirizzo+'<br/><b>DESDE-LTC: </b>'+feature.properties.mapcode2+'<br/><b>Beds: </b>'+feature.properties.availability_beds_r;
                    layer.bindPopup(content);
                    residentialSearch.push({
                        value: layer.feature.properties.name,
                        tokens: [layer.feature.properties.name],
                        layer: 'Residential',
                        id: layer._leaflet_id,
                        lat: layer.feature.geometry.coordinates[1],
                        lng: layer.feature.geometry.coordinates[0]
                    });
                }
            }
        });
        $.getJSON("data/residential.js", function (data) {
            residential.addData(data);
        });
		residential_markers.addLayer(residential);

		
//DAYCARE
var	daycare_markers = new L.MarkerClusterGroup({showCoverageOnHover: false,spiderfyOnMaxZoom:true,maxClusterRadius:20}); 

        var daycare = L.geoJson(daycare, {
            pointToLayer: function (feature, latlng) {
			if (feature.properties.group_b =='COMUNITY-BASED'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-plus-sign-alt', color: 'green'})
				,title: feature.properties.name,
                riseOnHover: true						
						})}
			if (feature.properties.group_b =='HOSPITAL'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-plus-sign-alt', color:'red'})
						,
						title: feature.properties.name,
						riseOnHover: true	
						})}
            },
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var content =   '<b>Name: </b>'+feature.properties.name+'<br/><b>Address: </b>'+feature.properties.indirizzo+'<br/><b>DESDE-LTC: </b>'+feature.properties.mapcode2+'<br/><b>Places: </b>'+feature.properties.availability_places_d;
                    layer.bindPopup(content);
                    daycareSearch.push({
                        value: layer.feature.properties.name,
                        tokens: [layer.feature.properties.name],
                        layer: 'Daycare',
                        id: layer._leaflet_id,
                        lat: layer.feature.geometry.coordinates[1],
                        lng: layer.feature.geometry.coordinates[0]
                    });
                }
            }
        });
        $.getJSON("data/daycare.js", function (data) {
            daycare.addData(data);
        });
		daycare_markers.addLayer(daycare);


//OUTPATIENT MOBILE
var	outpatient_mobile_markers = new L.MarkerClusterGroup({showCoverageOnHover: false,spiderfyOnMaxZoom:true,maxClusterRadius:20});   

var outpatient_mobile = L.geoJson(outpatient_mobile, {
            pointToLayer: function (feature, latlng) {
			if (feature.properties.group_b =='COMUNITY-BASED'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-ambulance', color: 'green'}), 
						 title: feature.properties.name,
						 riseOnHover: true})}
			if (feature.properties.group_b =='HOSPITAL'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-ambulance', color:'red'}), 
						title: feature.properties.name,
						riseOnHover: true})}
            },
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var content =   '<b>Name: </b>'+feature.properties.name+'<br/><b>Address: </b>'+feature.properties.indirizzo+'<br/><b>DESDE-LTC: </b>'+feature.properties.mapcode2;
                    layer.bindPopup(content);
                    outpatient_mSearch.push({
                        value: layer.feature.properties.name,
                        tokens: [layer.feature.properties.name],
                        layer: 'Outpatient mobile',
                        id: layer._leaflet_id,
                        lat: layer.feature.geometry.coordinates[1],
                        lng: layer.feature.geometry.coordinates[0]
                    });
                }
            }
        });
        $.getJSON("data/outpatient_mobile.js", function (data) {
            outpatient_mobile.addData(data);
        });
 outpatient_mobile_markers.addLayer(outpatient_mobile);

 
 //end outpatient MOBILE

var	outpatient_non_mobile_markers = new L.MarkerClusterGroup({showCoverageOnHover: false,spiderfyOnMaxZoom:true,maxClusterRadius:20});   

var outpatient_non_mobile = L.geoJson(outpatient_non_mobile, {
            pointToLayer: function (feature, latlng) {
			if (feature.properties.group_b =='COMUNITY-BASED'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-medkit', color: 'green'}), 
						 title: feature.properties.name,
						 riseOnHover: true})}
			if (feature.properties.group_b =='HOSPITAL'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-medkit', color:'red'}), 
						title: feature.properties.name,
						riseOnHover: true})}
			if (feature.properties.group_b =='md'){return L.marker(latlng, {
						icon: L.AwesomeMarkers.icon({icon: 'icon-user-md'}), 
						title: feature.properties.name,
						riseOnHover: true})}
            },
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var content =   '<b>Name: </b>'+feature.properties.name+'<br/><b>Address: </b>'+feature.properties.indirizzo+'<br/><b>DESDE-LTC: </b>'+feature.properties.mapcode2;
                    layer.bindPopup(content);
                    outpatient_non_Search.push({
                        value: layer.feature.properties.name,
                        tokens: [layer.feature.properties.name],
                        layer: 'Outpatient non mobile',
                        id: layer._leaflet_id,
                        lat: layer.feature.geometry.coordinates[1],
                        lng: layer.feature.geometry.coordinates[0]
                    });
                }
            }
        });
        $.getJSON("data/outpatient_non_mobile.js", function (data) {
            outpatient_non_mobile.addData(data);
        });
 outpatient_non_mobile_markers.addLayer(outpatient_non_mobile);

//OUTPATIENT NON MOBILE

//END

 
			map = L.map("map", {
            zoom: 4,
			minZoom: 4,
			maxZoom: 18,
            center: new L.LatLng(55.3,10.75),
            layers: [stamen_toner,esri,esri_satellite]
        });

		var miniMap = new L.Control.MiniMap(cloudmade2, {toggleDisplay: true,autoToggleDisplay: true}).addTo(map);


        var scaleControl = L.control.scale({
            position: 'bottomright'
        });

        // Larger screens get scale control and expanded layer control
        if (document.body.clientWidth <= 767) {
        var isCollapsed = true;
        } else {
            var isCollapsed = false;
            map.addControl(scaleControl);
        };

        var baseLayers = {
            "Minimal": stamen_toner,
            "ESRI": esri,
            "Satellite": esri_satellite
        };

        var overlays = {
			"Study area":study_area,
			"Macro area":macro_area,
            "<i class='icon-hospital icon-large'></i>&nbsp;&nbsp;<i class='icon-home icon-large'></i>&nbsp;Residential": residential_markers,
            "<i class='icon-plus-sign-alt icon-large'></i>&nbsp;Daycare": daycare_markers,
			"<i class='icon-ambulance icon-large'></i>&nbsp;Outpatient mobile": outpatient_mobile_markers,
            "<i class='icon-medkit icon-large'></i>&nbsp;&nbsp;<i class='icon-user-md icon-large'></i>&nbsp;Outpatient non mobile": outpatient_non_mobile_markers,
        };

        // var layerControl = L.control.layers(baseLayers, overlays, {
        //     collapsed: isCollapsed
        // }).addTo(map);

        // Highlight search box text on click
        $("#searchbox").click(function () {
            $(this).select();
        });

        // Typeahead search functionality
        $(document).one("ajaxStop", function() {
            $('#loading').hide();
            $('#searchbox').typeahead([{
                name: 'Residential',
                local: residentialSearch,
                minLength: 2,
                limit: 10,
                header: '<h4 class="typeahead-header"><i class="icon-hospital icon-large"></i>&nbsp;&nbsp;<i class="icon-home icon-large"></i>&nbsp;Residential</h4>'
            },{
                name: 'Daycare',
                local: daycareSearch,
                minLength: 2,
                limit: 10,
                header: '<h4 class="typeahead-header"><i class="icon-plus-sign-alt"></i>&nbsp;Daycare</h4>'
            },
			{
                name: 'Outpatient mobile',
                local: outpatient_mSearch,
                minLength: 2,
                limit: 10,
                header: '<h4 class="typeahead-header"><i class="icon-medkit"></i>&nbsp;Outpatient mobile</h4>'
            },
			{
                name: 'Outpatient non mobile',
                local: outpatient_non_Search,
                minLength: 2,
                limit: 10,
                header: '<h4 class="typeahead-header"><i class="icon-user-md"></i>&nbsp;Outpatient non mobile</h4>'
            }
			]).on('typeahead:selected', function (obj, datum) {
                if (datum.layer === 'Residential') {
                    if (!map.hasLayer(residential_markers)) {
                        map.addLayer(residential_markers);
                    };
                    map.setView([datum.lat, datum.lng], 17);
                    if (map._layers[datum.id]) {
                        map._layers[datum.id].openPopup();
                    };
                };
                if (datum.layer === 'Daycare') {
                    if (!map.hasLayer(daycare_markers)) {
                        map.addLayer(daycare_markers);
                    };
                    map.setView([datum.lat, datum.lng], 17);
                    if (map._layers[datum.id]) {
                        map._layers[datum.id].openPopup();
                    };
                };
				if (datum.layer === 'Outpatient mobile') {
                    if (!map.hasLayer(outpatient_mobile_markers)) {
                        map.addLayer(outpatient_mobile_markers);
                    };
                    map.setView([datum.lat, datum.lng], 17);
                    if (map._layers[datum.id]) {
                        map._layers[datum.id].openPopup();
                    };
                };
					if (datum.layer === 'Outpatient non mobile') {
                    if (!map.hasLayer(outpatient_non_mobile_markers)) {
                        map.addLayer(outpatient_non_mobile_markers);
                    };
                    map.setView([datum.lat, datum.lng], 17);
                    if (map._layers[datum.id]) {
                        map._layers[datum.id].openPopup();
                    };
                };

            }).on('typeahead:initialized ', function () {
                $('.tt-dropdown-menu').css('max-height', $('#container').height()-$('.navbar').height()-20);
                // $('.tt-dropdown-menu').css('min-width', $('.tt-dropdown-menu').width()+50);
            });
        });

        // Placeholder hack for IE
        if (navigator.appName == "Microsoft Internet Explorer") {
            $("input").each( function () {
                if ($(this).val() == "" && $(this).attr("placeholder") != "") {
                    $(this).val($(this).attr("placeholder"));
                    $(this).focus(function () {
                        if ($(this).val() == $(this).attr("placeholder")) $(this).val("");
                    });
                    $(this).blur(function () {
                        if ($(this).val() == "") $(this).val($(this).attr("placeholder"));
                    });
                }
            });
        }
	
	if (document.body.clientWidth <= 767) {
        $(".leaflet-control-minimap").hide();
        }   else {
            $(".leaflet-control-minimap").show();
        };  
	
//
//thematic layer: density,urban degree     

    
    	var layerUrl = 'https://dsalazzari.cartodb.com/api/v2/viz/study_area_pop/viz.json';
		  var sublayers = [];

		
		
		
		//style pop density
		style_densita="#study_area_pop{line-color:#999;line-width:1;polygon-opacity:0.8;}#study_area_pop[densita > 1000]{		polygon-fill:#800026;}#study_area_pop[densita <= 1000]{		polygon-fill:#B10026;}#study_area_pop [ densita <= 500] {polygon-fill: #E31A1C;}#study_area_pop[densita<= 200]{polygon-fill: #FC4E2A;}#study_area_pop[densita<=100]{polygon-fill:#FD8D3C;}#study_area_pop[densita <= 60]{polygon-fill:#FEB24C;}#study_area_pop[densita<=30]{polygon-fill:#FED976;}#study_area_pop[densita<= 20]{polygon-fill:#FFFFB2;}#study_area_pop::labels {text-name: [nome];text-halo-fill: #FFF;text-halo-radius: 1;text-face-name: 'DejaVu Sans Book';  text-size: 10;text-fill: #000;}";
		//style urban
		style_urban="#study_area_pop{line-color:#999;line-width:1;polygon-opacity:0.8;}#study_area_pop[dgur_code = 1.0]{		polygon-fill:#FF0000;}#study_area_pop[ dgur_code = 2.0]{polygon-fill:#FFFF00;}#study_area_pop[dgur_code = 3.0]{polygon-fill: #009900;}#study_area_pop::labels {text-name: [nome];text-halo-fill: #FFF;text-halo-radius: 1;text-face-name: 'DejaVu Sans Book';  text-size: 10;text-fill: #000;}";
		
		query_it="SELECT * FROM study_area_pop WHERE cntry_code='IT'";
		query_at="SELECT * FROM study_area_pop WHERE cntry_code='AT'";
		query_ro="SELECT * FROM study_area_pop WHERE cntry_code='RO'";
		query_fi="SELECT * FROM study_area_pop WHERE cntry_code='FI'";
		query_fr="SELECT * FROM study_area_pop WHERE cntry_code='FR'";
		query_es="SELECT * FROM study_area_pop WHERE cntry_code='ES'";
		query_ee="SELECT * FROM study_area_pop WHERE cntry_code='EE'";
		query_uk="SELECT * FROM study_area_pop WHERE cntry_code='UK'";
		query_no="SELECT * FROM study_area_pop WHERE cntry_code='NO'";
		query_null="SELECT * FROM study_area_pop WHERE cntry_code='zzz'";
		

		
		
		
	cartodb.createLayer(map, layerUrl)
  .addTo(map)
  .on('done', function(layer) {
    // change the query for the first layer
    var subLayerOptions = {
      sql: query_null,
      cartocss: style_densita,
	interactivity: 'nome,densita,pop,cntry_code', infowindow: false,
	

	}

    var sublayer = layer.getSubLayer(0);

    sublayer.set(subLayerOptions);

    sublayers.push(sublayer);
  }).on('error', function() {
    //log the error
  });
		  
		 
//end density and urban layers	

//isochrones layers
    	var layerUrl2 = 'https://dsalazzari.cartodb.com/api/v2/viz/isochrone/viz.json';

var sublayers2 = [];
		
//style isochrone
		style_iso="#isochrone{line-color:#999;line-width:1;polygon-opacity:0.8;}#isochrone[name='0 - 10']{polygon-fill:#80B080;}#isochrone[name='10 - 20']{polygon-fill:#BED681;}#isochrone[name = '20 - 30']{polygon-fill: #FFCC80;}#isochrone[name='30 - 60']{polygon-fill:#FF9180;}";
		
		//mobile
		query_en_iso_m="SELECT * FROM isochrone WHERE country='en' and type='m'";
		query_fi_iso_m="SELECT * FROM isochrone WHERE country='fi' and type='m'";
		query_fr_iso_m="SELECT * FROM isochrone WHERE country='fr' and type='m'";
		query_it_iso_m="SELECT * FROM isochrone WHERE country='it' and type='m'";
		query_no_iso_m="SELECT * FROM isochrone WHERE country='no' and type='m'";
		query_es_iso_m="SELECT * FROM isochrone WHERE country='es' and type='m'";
		
		//acute
		query_at_iso_a="SELECT * FROM isochrone WHERE country='at' and type='a'";
		query_en_iso_a="SELECT * FROM isochrone WHERE country='en' and type='a'";
		query_ee_iso_a="SELECT * FROM isochrone WHERE country='ee' and type='a'";
		query_fi_iso_a="SELECT * FROM isochrone WHERE country='fi' and type='a'";
		query_fr_iso_a="SELECT * FROM isochrone WHERE country='fr' and type='a'";
		query_it_iso_a="SELECT * FROM isochrone WHERE country='it' and type='a'";
		query_no_iso_a="SELECT * FROM isochrone WHERE country='no' and type='a'";
		query_ro_iso_a="SELECT * FROM isochrone WHERE country='ro' and type='a'";
		query_es_iso_a="SELECT * FROM isochrone WHERE country='es' and type='a'";
		//reset
		query_iso_null="SELECT * FROM isochrone WHERE country='eas' and type='a'";

		
cartodb.createLayer(map, layerUrl2)
  .addTo(map)
  .on('done', function(layer) {
    // change the query for the first layer
    var subLayerOptions2 = {
      sql: query_iso_null,
      cartocss: style_iso,
	  interactivity: 'name,people', infowindow: false}

    var sublayer2 = layer.getSubLayer(0);

    sublayer2.set(subLayerOptions2);

    sublayers2.push(sublayer2);
  }).on('error', function() {
    //log the error
  });

//end iso  
		
		
		  
$('.button').click(function(){
				$('.button').removeClass('selected');
				$(this).addClass('selected');
				LayerActions[$(this).attr('id')]();
		 })

var LayerActions = {
								  Austria: function(){
									sublayers[0].set({sql:query_at,cartocss:style_densita,interactivity: 'nome,densita,pop'}) , $('#legend_density').show(),map.fitBounds(austria.getBounds()),$('#legend_urban').hide(),$('#legend_iso').hide(),sublayers2[0].set({sql:query_iso_null});
									return true;
								  },
								  Italy: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_it,cartocss:style_densita,interactivity: 'nome,densita,pop'}) , $('#legend_density').show(),map.fitBounds(italy.getBounds()),$('#legend_urban').hide(),$('#legend_iso').hide();
									return true;
								  },
								  England: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_uk,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(england.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  Norway: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_no,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(norway.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  Romania: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_ro,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(romania.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  France: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_fr,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(france.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  Spain: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_es,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(spain.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  Finland: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_fi,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(finland.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  }
								  ,
								  Estonia: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_ee,cartocss:style_densita,interactivity: 'nome,densita,pop'}) ,map.fitBounds(estonia.getBounds()),$('#legend_iso').hide(),
									$('#legend_density').show(),$('#legend_urban').hide();
									return true;
								  },
								    Italy_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_it,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(italy.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  Austria_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_at,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(austria.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  England_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_uk,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(england.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								    Finland_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_fi,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(finland.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  	France_urb: function(){
									sublayers[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_fr,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(france.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  	Spain_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_es,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(spain.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  	Norway_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_no,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(norway.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  	Romania_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_ro,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(romania.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  	Estonia_urb: function(){
									sublayers2[0].set({sql:query_iso_null}),sublayers[0].set({sql:query_ee,cartocss:style_urban,interactivity: 'nome,cntry_code'}) ,map.fitBounds(estonia.getBounds()),$('#legend_iso').hide(),
									$('#legend_urban').show(),$('#legend_density').hide();
									return true;
								  },
								  England_iso_m: function(){
									sublayers2[0].set({sql:query_en_iso_m,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(england.getBounds()),
									$('#legend_iso').show(),$('#legend_urban').hide(),$('#legend_density').hide();
									return true;
								  },
								  Finland_iso_m: function(){
									sublayers2[0].set({sql:query_fi_iso_m,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(finland.getBounds());
									return true;
								  },
								  France_iso_m: function(){
									sublayers2[0].set({sql:query_fr_iso_m,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(france.getBounds());
									return true;
								  },
								  Italy_iso_m: function(){
									sublayers[0].set({sql:query_null}),sublayers2[0].set({sql:query_it_iso_m,cartocss:style_iso,interactivity: 'name,people'}) ,$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(italy.getBounds());
									return true;
								  },
								  Norway_iso_m: function(){
									sublayers[0].set({sql:query_null}),sublayers2[0].set({sql:query_no_iso_m,cartocss:style_iso,interactivity: 'name,people'}) ,$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(norway.getBounds());
									return true;
								  },
								  Spain_iso_m: function(){
									sublayers2[0].set({sql:query_es_iso_m,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(spain.getBounds());
									return true;
								  },
								   Austria_iso_a: function(){
									sublayers2[0].set({sql:query_at_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}) ,$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(austria.getBounds());
									return true;
								  },
								  England_iso_a: function(){
									sublayers2[0].set({sql:query_en_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(england.getBounds());
									return true;
								  },
								  Estonia_iso_a: function(){
									sublayers[0].set({sql:query_null}),sublayers2[0].set({sql:query_ee_iso_a,cartocss:style_iso,interactivity: 'name,people'}) ,$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(estonia.getBounds());
									return true;
								  },
								  Finland_iso_a: function(){
									sublayers2[0].set({sql:query_fi_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(finland.getBounds());
									return true;
								  },
								  France_iso_a: function(){
									sublayers2[0].set({sql:query_fr_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(france.getBounds());
									return true;
								  },
								  Italy_iso_a: function(){
									sublayers2[0].set({sql:query_it_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(italy.getBounds());
									return true;
								  },
								  Norway_iso_a: function(){
									sublayers2[0].set({sql:query_no_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(norway.getBounds());
									return true;
								  },
								  Romania_iso_a: function(){
									sublayers2[0].set({sql:query_ro_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(romania.getBounds());
									return true;
								  },
								  Spain_iso_a: function(){
									sublayers2[0].set({sql:query_es_iso_a,cartocss:style_iso,interactivity: 'name,people'}),sublayers[0].set({sql:query_null}),$('#legend_iso').show(),$('#legend_density').hide(),$('#legend_urban').hide(),map.fitBounds(spain.getBounds());
									return true;
								  },
								   Reset_layer: function(){
									sublayers[0].set({sql:query_null}) , sublayers2[0].set({sql:query_iso_null}),$('#legend_density').hide(),$('#legend_urban').hide(),$('#legend_iso').hide();
									return true;
								  }
							}
	




	</script>
	  
  </body>
</html>
